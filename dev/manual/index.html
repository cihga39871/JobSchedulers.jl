<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Manual · JobSchedulers.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">JobSchedulers.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Manual</a><ul class="internal"><li><a class="tocitem" href="#Scheduler-control"><span>Scheduler control</span></a></li><li><a class="tocitem" href="#Scheduler-settings"><span>Scheduler settings</span></a></li><li><a class="tocitem" href="#Job-controls"><span>Job controls</span></a></li><li><a class="tocitem" href="#Queue"><span>Queue</span></a></li><li><a class="tocitem" href="#Job-query"><span>Job query</span></a></li><li><a class="tocitem" href="#Wait-for-all-jobs-and-progress-meter"><span>Wait for all jobs and progress meter</span></a></li><li><a class="tocitem" href="#Find-optimized-ncpu-that-a-Job-can-use"><span>Find optimized <code>ncpu</code> that a Job can use</span></a></li><li><a class="tocitem" href="#Compatibility-with-Pipelines.jl"><span>Compatibility with Pipelines.jl</span></a></li><li><a class="tocitem" href="#Backup"><span>Backup</span></a></li></ul></li><li><a class="tocitem" href="../API/">API</a></li><li><a class="tocitem" href="../changelog/">Change Log</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Manual</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Manual</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/cihga39871/JobSchedulers.jl/blob/main/docs/src/manual.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Manual"><a class="docs-heading-anchor" href="#Manual">Manual</a><a id="Manual-1"></a><a class="docs-heading-anchor-permalink" href="#Manual" title="Permalink"></a></h1><p>If you need to run multiple heavy Julia tasks, it is recommended to <a href="https://docs.julialang.org/en/v1/manual/multi-threading/#Starting-Julia-with-multiple-threads">start Julia with multi-threads</a>.</p><pre><code class="language-julia hljs">using JobSchedulers, Dates</code></pre><h2 id="Scheduler-control"><a class="docs-heading-anchor" href="#Scheduler-control">Scheduler control</a><a id="Scheduler-control-1"></a><a class="docs-heading-anchor-permalink" href="#Scheduler-control" title="Permalink"></a></h2><pre><code class="language-julia hljs">scheduler_start()
# [ Info: Scheduler starts.

scheduler_status()
# ┌ Info: Scheduler is running.
# │   SCHEDULER_MAX_CPU = 32
# │   SCHEDULER_MAX_MEM = 121278191616
# │   SCHEDULER_UPDATE_SECOND = 0.05
# │   JOB_QUEUE_MAX_LENGTH = 10000
# └   SCHEDULER_TASK = Task (runnable) @0x00007fe205052e60
# :running

scheduler_stop()</code></pre><h2 id="Scheduler-settings"><a class="docs-heading-anchor" href="#Scheduler-settings">Scheduler settings</a><a id="Scheduler-settings-1"></a><a class="docs-heading-anchor-permalink" href="#Scheduler-settings" title="Permalink"></a></h2><p>Set the <strong>maximum CPU</strong> that the scheduler can use. If starting Julia with multi-threads, the maximum CPU is <code>nthreads() - 1</code>.</p><pre><code class="language-julia hljs">set_scheduler_max_cpu()     # use all available CPUs
# 32
set_scheduler_max_cpu(4)    # use 4 CPUs
# 4
set_scheduler_max_cpu(0.5)  # use 50% of CPUs
# 16</code></pre><p>Set the <strong>maximum RAM</strong> the scheduler can use:</p><pre><code class="language-julia hljs">set_scheduler_max_mem()             # use 80% of total memory
# 107792089088

set_scheduler_max_mem(4GB)          # use 4GB memory
set_scheduler_max_mem(4096MB)
set_scheduler_max_mem(4194304KB)
set_scheduler_max_mem(4294967296B)
# 4294967296
set_scheduler_max_mem(0.5)          # use 50% of total memory
# 67370055680</code></pre><p>Set the update interval of job queue:</p><pre><code class="language-julia hljs">set_scheduler_update_second(0.03)  # update job queue every 0.3 seconds
# 0.03</code></pre><p>Set the maximum number of finished jobs:</p><pre><code class="language-julia hljs">set_scheduler_max_job(10000)  # If number of finished jobs &gt; 10000, the oldest ones will be removed.
# 10000                       # It does not affect queuing or running jobs.</code></pre><p>Set the previous setting in one function:</p><pre><code class="language-julia hljs">set_scheduler(
    max_cpu = JobSchedulers.SCHEDULER_MAX_CPU,
    max_mem = JobSchedulers.SCHEDULER_MAX_MEM,
    update_second = JobSchedulers.SCHEDULER_UPDATE_SECOND,
    max_job = JobSchedulers.JOB_QUEUE_MAX_LENGTH
)
# ┌ Info: Scheduler is running.
# │   SCHEDULER_MAX_CPU = 16
# │   SCHEDULER_MAX_MEM = 67370055680
# │   SCHEDULER_UPDATE_SECOND = 0.03
# │   JOB_QUEUE_MAX_LENGTH = 10000
# └   SCHEDULER_TASK = Task (runnable) @0x00007fd239184fe0
# :running</code></pre><h2 id="Job-controls"><a class="docs-heading-anchor" href="#Job-controls">Job controls</a><a id="Job-controls-1"></a><a class="docs-heading-anchor-permalink" href="#Job-controls" title="Permalink"></a></h2><p>A <code>Job</code> is the wrapper of <code>AbstractCmd</code>, <code>Function</code> or <code>Task</code>:</p><pre><code class="language-julia hljs">command_job = Job(
    `echo command job done`    # AbstractCmd to run
)

function_job = Job() do  # the function should have no arguments
    println(&quot;function job done&quot;)
end

task_job = Job(
    @task(println(&quot;task job done&quot;))  # Task to run
)

job_with_args = Job(
    @task(begin println(&quot;job_with_args done&quot;); &quot;result&quot; end); # Task to run
    name = &quot;job with args&quot;,               # job name.
    user = &quot;me&quot;,                # Job owner.
    ncpu = 1,                   # Number of CPU required.
    mem = 1KB,                  # Number of memory required (unit: TB, GB, MB, KB, B).
    schedule_time = Second(3),  # Run after 3 seconds; can be ::DateTime or ::Period.
    wall_time = Hour(1),        # The maximum time to run the job. (Cancel job after reaching wall time.)
    priority = 20,              # Lower number = higher priority.
    dependency = [              # Defer job until some jobs reach some states.
        DONE =&gt; command_job,
        DONE =&gt; task_job.id
    ]
)
# Job:
#   id            → 3603962603799412
#   name          → &quot;job with args&quot;
#   user          → &quot;me&quot;
#   ncpu          → 1
#   mem           → 1024
#   schedule_time → 2022-11-18 11:35:08
#   create_time   → 0000-01-01 00:00:00
#   start_time    → 0000-01-01 00:00:00
#   stop_time     → 0000-01-01 00:00:00
#   wall_time     → 1 hour
#   state         → :queuing
#   priority      → 20
#   dependency    → 2 jobs
#   task          → Task
#   stdout_file   → &quot;&quot;
#   stderr_file   → &quot;&quot;
#   _thread_id    → 0</code></pre><blockquote><p><code>dependency</code> argument in <code>Job(...)</code> controls when to start a job.</p><p>It is a vector with element <code>STATE =&gt; job</code> or <code>STATE =&gt; job.id</code>.</p><p>STATE is one of <code>DONE</code>, <code>FAILED</code>, <code>CANCELLED</code>, <code>QUEUING</code>, <code>RUNNING</code>, <code>PAST</code>.   The first 5 states are real job states.   <code>PAST</code> is the super set of <code>DONE</code>, <code>FAILED</code>, <code>CANCELLED</code>, which means the job will not run in the future.</p></blockquote><p>Submit a job to queue:</p><pre><code class="language-julia hljs">submit!(command_job)
submit!(task_job)
submit!(job_with_args)</code></pre><p>Cancel or interrupt a job:</p><pre><code class="language-julia hljs">cancel!(command_job)</code></pre><p>Get the returned result:</p><pre><code class="language-julia hljs">result(job_with_args)
# &quot;result&quot;</code></pre><h2 id="Queue"><a class="docs-heading-anchor" href="#Queue">Queue</a><a id="Queue-1"></a><a class="docs-heading-anchor-permalink" href="#Queue" title="Permalink"></a></h2><p>Show queue (all jobs):</p><pre><code class="language-julia hljs">queue(:all)      # or:
queue(all=true)  # or:
all_queue()
# 3-element Vector{Job}:
# ┌─────┬───────┬──────────────────┬─────────────────┬──────┬──────┬────────
# │ Row │ state │               id │            name │ user │ ncpu │  mem  ⋯
# ├─────┼───────┼──────────────────┼─────────────────┼──────┼──────┼────────
# │   1 │ :done │ 3603962559801309 │              &quot;&quot; │   &quot;&quot; │    1 │    0  ⋯
# │   2 │ :done │ 3603962563817452 │              &quot;&quot; │   &quot;&quot; │    1 │    0  ⋯
# │   3 │ :done │ 3603962603799412 │ &quot;job with args&quot; │ &quot;me&quot; │    1 │ 1024  ⋯
# └─────┴───────┴──────────────────┴─────────────────┴──────┴──────┴────────
#                                                         11 columns omitted</code></pre><p>Show queue (running and queuing jobs only):</p><pre><code class="language-julia hljs">queue()
# 0-element Vector{Job}:</code></pre><p>Show queue using a job state (<code>QUEUING</code>, <code>RUNNING</code>, <code>DONE</code>, <code>FAILED</code>, <code>CANCELLED</code>, or <code>PAST</code>):</p><pre><code class="language-julia hljs">queue(DONE)
# 3-element Vector{Job}:
# ┌─────┬───────┬──────────────────┬─────────────────┬──────┬──────┬────────
# │ Row │ state │               id │            name │ user │ ncpu │  mem  ⋯
# ├─────┼───────┼──────────────────┼─────────────────┼──────┼──────┼────────
# │   1 │ :done │ 3603962559801309 │              &quot;&quot; │   &quot;&quot; │    1 │    0  ⋯
# │   2 │ :done │ 3603962563817452 │              &quot;&quot; │   &quot;&quot; │    1 │    0  ⋯
# │   3 │ :done │ 3603962603799412 │ &quot;job with args&quot; │ &quot;me&quot; │    1 │ 1024  ⋯
# └─────┴───────┴──────────────────┴─────────────────┴──────┴──────┴────────
#                                                         11 columns omitted</code></pre><p><code>queue(...)</code> and <code>all_queue()</code> can also used to filter job name and user. Please find out more by typing <code>?queue</code> and <code>?all_queue</code> in REPL.</p><h2 id="Job-query"><a class="docs-heading-anchor" href="#Job-query">Job query</a><a id="Job-query-1"></a><a class="docs-heading-anchor-permalink" href="#Job-query" title="Permalink"></a></h2><p>Get <code>Job</code> object by providing job ID.</p><pre><code class="language-julia hljs">job_query(3603962563817452)  # or:
queue(3603962563817452)
# Job:
#   id            → 3603962563817452
#   name          → &quot;&quot;
#   user          → &quot;&quot;
#   ncpu          → 1
#   mem           → 0
#   schedule_time → 0000-01-01 00:00:00
#   create_time   → 2022-11-18 11:35:30
#   start_time    → 2022-11-18 11:35:30
#   stop_time     → 2022-11-18 11:35:30
#   wall_time     → 1 week
#   state         → :done
#   priority      → 20
#   dependency    → []
#   task          → Task
#   stdout_file   → &quot;&quot;
#   stderr_file   → &quot;&quot;
#   _thread_id    → 0</code></pre><h2 id="Wait-for-all-jobs-and-progress-meter"><a class="docs-heading-anchor" href="#Wait-for-all-jobs-and-progress-meter">Wait for all jobs and progress meter</a><a id="Wait-for-all-jobs-and-progress-meter-1"></a><a class="docs-heading-anchor-permalink" href="#Wait-for-all-jobs-and-progress-meter" title="Permalink"></a></h2><p>Wait for all jobs in <code>queue()</code> finished using <code>wait_queue(; show_progress::Bool)</code>.</p><p>If <code>show_progress = true</code>, a fancy progress meter will display.</p><pre><code class="language-julia hljs">wait_queue()
# no output

wait_queue(show_progress = true)</code></pre><p><img src="../assets/progress_meter.png" alt="progress meter"/></p><h2 id="Find-optimized-ncpu-that-a-Job-can-use"><a class="docs-heading-anchor" href="#Find-optimized-ncpu-that-a-Job-can-use">Find optimized <code>ncpu</code> that a Job can use</a><a id="Find-optimized-ncpu-that-a-Job-can-use-1"></a><a class="docs-heading-anchor-permalink" href="#Find-optimized-ncpu-that-a-Job-can-use" title="Permalink"></a></h2><p>Only available from JobSchedulers v0.7.8.</p><pre><code class="language-julia hljs">solve_optimized_ncpu(default::Int; 
    ncpu_range::UnitRange{Int64} = 1:total_cpu, 
    njob::Int = 1, 
    total_cpu::Int = JobSchedulers.SCHEDULER_MAX_CPU, 
    side_jobs_cpu::Int = 0)</code></pre><p>Find the optimized number of CPU for a job.</p><ul><li><code>default</code>: default ncpu of the job.</li><li><code>ncpu_range</code>: the possible ncpu range of the job.</li><li><code>njob</code>: number of the same job.</li><li><code>total_cpu</code>: the total CPU that can be used by JobSchedulers.</li><li><code>side_jobs_cpu</code>: some small jobs that might be run when the job is running, so the job won&#39;t use up all of the resources and stop small tasks.</li></ul><h2 id="Compatibility-with-Pipelines.jl"><a class="docs-heading-anchor" href="#Compatibility-with-Pipelines.jl">Compatibility with Pipelines.jl</a><a id="Compatibility-with-Pipelines.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Compatibility-with-Pipelines.jl" title="Permalink"></a></h2><p>[Pipelines.jl]: https://cihga39871.github.io/Pipelines.jl/dev/	&quot;Pipelines.jl: A lightweight Julia package for computational pipelines and workflows.&quot;</p><p>You can also create a <code>Job</code> by using <code>Program</code> types from Pipelines.jl:</p><pre><code class="language-julia hljs">Job(p::Program; program_kwargs..., run_kwargs..., job_kwargs...)
Job(p::Program, inputs; run_kwargs..., job_kwargs...)
Job(p::Program, inputs, outputs; run_kwargs..., job_kwargs...)</code></pre><ul><li><code>program_kwargs...</code> is input and output arguments defined in <code>p::Program</code>.</li><li><code>run_kwargs...</code> is keyword arguments of <code>run(::Program; ...)</code></li><li><code>job_kwargs...</code> is keyword arguments of <code>Job(::Union{Base.AbstractCmd,Task}; ...)</code></li></ul><p>Details can be found by typing</p><pre><code class="language-julia hljs">julia&gt; using Pipelines, JobSchedulers
julia&gt; ?run
julia&gt; ?Job</code></pre><h3 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h3><pre><code class="language-julia hljs">using Pipelines, JobSchedulers

scheduler_start()

p = CmdProgram(
    inputs = [&quot;IN1&quot;, &quot;IN2&quot;],
    outputs = &quot;OUT&quot;,
    cmd = pipeline(`echo inputs are: IN1 and IN2` &amp; `echo outputs are: OUT`)
)
# CmdProgram:
#   name             → Command Program
#   id_file          → 
#   info_before      → auto
#   info_after       → auto
#   cmd_dependencies → CmdDependency[]
#   arg_inputs       → IN1 :: Any (required)
#                      IN2 :: Any (required)
#   validate_inputs  → do_nothing
#   prerequisites    → do_nothing
#   cmd              → `echo inputs are: IN1 and IN2` &amp; `echo outputs are: OUT`
#   infer_outputs    → do_nothing
#   arg_outputs      → OUT :: Any (required)
#   validate_outputs → do_nothing
#   wrap_up          → do_nothing
#   arg_forward      → Pair{String, Symbol}[]


### native Pipelines.jl method to run the program
run(p, IN1 = `in1`, IN2 = 2, OUT = &quot;out&quot;, touch_run_id_file = false) # touch_run_id_file = false means do not create a file which indicates the job is done and avoids re-run.

# inputs are: in1 and in2
# outputs are: out
# (true, Dict(&quot;OUT&quot; =&gt; &quot;out&quot;))

### run the program by submitting to JobSchedulers.jl
program_job = Job(p, IN1 = `in1`, IN2 = 2, OUT = &quot;out&quot;, touch_run_id_file = false)
# Job:
#   id            → 3603980229784158
#   name          → &quot;Command Program&quot;
#   user          → &quot;&quot;
#   ncpu          → 1
#   mem           → 0
#   schedule_time → 0000-01-01 00:00:00
#   create_time   → 0000-01-01 00:00:00
#   start_time    → 0000-01-01 00:00:00
#   stop_time     → 0000-01-01 00:00:00
#   wall_time     → 1 week
#   state         → :queuing
#   priority      → 20
#   dependency    → []
#   task          → Task
#   stdout_file   → &quot;&quot;
#   stderr_file   → &quot;&quot;
#   _thread_id    → 0

submit!(program_job)
# inputs are: in1 and 2
# outputs are: out

# get the returned result
result(program_job)
# (true, Dict(&quot;OUT&quot; =&gt; &quot;out&quot;))</code></pre><h2 id="Backup"><a class="docs-heading-anchor" href="#Backup">Backup</a><a id="Backup-1"></a><a class="docs-heading-anchor-permalink" href="#Backup" title="Permalink"></a></h2><p>Set backup file:</p><pre><code class="language-julia hljs">set_scheduler_backup(&quot;/path/to/backup/file&quot;)</code></pre><blockquote><p>JobSchedulers writes to the backup file at exit. If the file exists, scheduler settings and job queue will be recovered from it automatically. Recovered jobs are just for query, not run-able.</p></blockquote><p>Stop backup and <code>delete_old</code> backup:</p><pre><code class="language-julia hljs">set_scheduler_backup(delete_old=true)</code></pre><p>Backup immediately:</p><pre><code class="language-julia hljs">backup()</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../API/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 5 April 2023 16:09">Wednesday 5 April 2023</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
